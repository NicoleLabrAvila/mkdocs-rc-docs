



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the centrally provided Research Computing HPC services at UCL.">
      
      
        <link rel="canonical" href="https://www.rc.ucl.ac.uk/docs/Software_Guides/Matlab/">
      
      
        <meta name="author" content="UCL RCAS Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>MATLAB</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/tweaks.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#setup" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.rc.ucl.ac.uk/docs/" title="UCL Research Computing Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../img/portico.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              UCL Research Computing Documentation
            </span>
            <span class="md-header-nav__topic">
              
                MATLAB
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/UCL-RITS/mkdocs-rc-docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    UCL-RITS/mkdocs-rc-docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.rc.ucl.ac.uk/docs/" title="UCL Research Computing Documentation" class="md-nav__button md-logo">
      
        <img src="../../img/portico.svg" width="48" height="48">
      
    </a>
    UCL Research Computing Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/UCL-RITS/mkdocs-rc-docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    UCL-RITS/mkdocs-rc-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Account_Services/" title="Account Services" class="md-nav__link">
      Account Services
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Contact_Us/" title="Contact and Support" class="md-nav__link">
      Contact and Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Experienced_Users/" title="Quick Start Guide for Experienced HPC Users" class="md-nav__link">
      Quick Start Guide for Experienced HPC Users
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Job_Results/" title="Where do my results go?" class="md-nav__link">
      Where do my results go?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../New_Users/" title="Guide for New Users" class="md-nav__link">
      Guide for New Users
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Planned_Outages/" title="Planned Outages" class="md-nav__link">
      Planned Outages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Terms_and_Conditions/" title="Terms and Conditions" class="md-nav__link">
      Terms and Conditions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../UCL_Service_For_Me/" title="UCL Service For Me" class="md-nav__link">
      UCL Service For Me
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../howto/" title="How do I?" class="md-nav__link">
      How do I?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Background/Cluster_Computing/" title="Cluster Computing" class="md-nav__link">
      Cluster Computing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Clusters
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Clusters
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Clusters/Myriad/" title="Myriad" class="md-nav__link">
      Myriad
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Clusters/Legion/" title="Legion" class="md-nav__link">
      Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Clusters/Grace/" title="Grace" class="md-nav__link">
      Grace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Clusters/Kathleen/" title="Kathleen" class="md-nav__link">
      Kathleen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Clusters/Thomas/" title="MMM Thomas" class="md-nav__link">
      MMM Thomas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Clusters/Michael/" title="MMM Michael" class="md-nav__link">
      MMM Michael
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Installed Software Lists
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Installed Software Lists
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Installed_Software_Lists/module-packages/" title="General Software Lists" class="md-nav__link">
      General Software Lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Installed_Software_Lists/python-packages/" title="Python Packages" class="md-nav__link">
      Python Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Installed_Software_Lists/r-packages/" title="R Packages" class="md-nav__link">
      R Packages
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Other Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Other Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Other_Services/Aristotle/" title="Aristotle" class="md-nav__link">
      Aristotle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Other_Services/UCL_UK_e-Science_Certificates/" title="UCL UK e-Science Certificates" class="md-nav__link">
      UCL UK e-Science Certificates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      Paid For Resources
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        Paid For Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Paid-For_Resources/How_to_Use/" title="How to Use" class="md-nav__link">
      How to Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Paid-For_Resources/Purchasing_in_Myriad/" title="Purchasing in Myriad" class="md-nav__link">
      Purchasing in Myriad
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16" checked>
    
    <label class="md-nav__link" for="nav-16">
      Software Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        Software Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        MATLAB
      </label>
    
    <a href="./" title="MATLAB" class="md-nav__link md-nav__link--active">
      MATLAB
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-multi-threaded-batch-jobs" class="md-nav__link">
    Single node multi-threaded batch jobs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-without-the-jvm-to-reduce-overhead" class="md-nav__link">
    Run without the JVM to reduce overhead
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-single-threaded" class="md-nav__link">
    Run single-threaded
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-matlab-gui-interactively" class="md-nav__link">
    Using the MATLAB GUI interactively
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submitting-jobs-using-the-distributed-computing-server-dcs" class="md-nav__link">
    Submitting jobs using the Distributed Computing Server (DCS)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importing-the-cluster-profile" class="md-nav__link">
    Importing the cluster profile
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-using-matlab-functions" class="md-nav__link">
    Import using MATLAB functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-from-matlab-gui" class="md-nav__link">
    Import from MATLAB GUI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables-needed-for-job-submission" class="md-nav__link">
    Environment variables needed for job submission
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-a-simple-dcs-job" class="md-nav__link">
    Example: a simple DCS job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-a-dcs-job-with-more-than-one-input-file" class="md-nav__link">
    Example: a DCS job with more than one input file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    Further reading
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submitting-matlab-jobs-from-your-workstationlaptop" class="md-nav__link">
    Submitting MATLAB jobs from your workstation/laptop
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-setup" class="md-nav__link">
    Remote setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submitting-a-job-to-the-cluster" class="md-nav__link">
    Submitting a job to the cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-your-results" class="md-nav__link">
    Viewing your results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-intermediate-results" class="md-nav__link">
    Writing intermediate results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-remote-jobs" class="md-nav__link">
    Troubleshooting remote jobs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-matlab-on-gpus" class="md-nav__link">
    Running MATLAB on GPUs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Singularity/" title="Singularity" class="md-nav__link">
      Singularity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Other_Software/" title="Other Software" class="md-nav__link">
      Other Software
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      Wiki Export
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        Wiki Export
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Acknowledging_RC_Systems/" title="Acknowledging the Use of RC Systems" class="md-nav__link">
      Acknowledging the Use of RC Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Additional_Resource_Requests/" title="Additional Resource Requests" class="md-nav__link">
      Additional Resource Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Building_and_Running_Matlab_Programs/" title="Building and Running Matlab Programs" class="md-nav__link">
      Building and Running Matlab Programs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Compiling/" title="Compiling Your Code" class="md-nav__link">
      Compiling Your Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Connecting_to_RC_Systems/" title="Connecting to RC Systems" class="md-nav__link">
      Connecting to RC Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Connecting_to_Research_Data_Services/" title="Connecting to Research Data Services" class="md-nav__link">
      Connecting to Research Data Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Example_Submission_Scripts/" title="Example Submission Scripts" class="md-nav__link">
      Example Submission Scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/FAQ/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/GPU_Clusters/" title="GPU clusters" class="md-nav__link">
      GPU clusters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/GPU_Nodes/" title="GPU nodes" class="md-nav__link">
      GPU nodes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Getting_an_Account/" title="Getting an Account" class="md-nav__link">
      Getting an Account
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Installing_PGI/" title="Installing PGI" class="md-nav__link">
      Installing PGI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Interactive_Jobs/" title="Interactive Job Sessions" class="md-nav__link">
      Interactive Job Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Known_Issues/" title="Known Issues" class="md-nav__link">
      Known Issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/News_and_Events/" title="News and Events" class="md-nav__link">
      News and Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Planned_Service_Outages/" title="Planned Service Outages" class="md-nav__link">
      Planned Service Outages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Points_of_Contact/" title="Points of Contact" class="md-nav__link">
      Points of Contact
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Quick_Start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/RC_Systems/" title="Research Computing Platforms" class="md-nav__link">
      Research Computing Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/RC_Systems_user_environment/" title="RC Systems user environment" class="md-nav__link">
      RC Systems user environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Reporting_problems/" title="Reporting problems" class="md-nav__link">
      Reporting problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Research_Computing_Glossary/" title="Research Computing Glossary" class="md-nav__link">
      Research Computing Glossary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Terms_and_Conditions/" title="Terms and Conditions of Use" class="md-nav__link">
      Terms and Conditions of Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Training/" title="Training" class="md-nav__link">
      Training
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/User_Scripts/" title="User Scripts" class="md-nav__link">
      User Scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/X-Forwarding/" title="X-Forwarding" class="md-nav__link">
      X-Forwarding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17-28" type="checkbox" id="nav-17-28">
    
    <label class="md-nav__link" for="nav-17-28">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-17-28">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Background/Batch_Processing/" title="Batch Processing" class="md-nav__link">
      Batch Processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Background/Cluster_Computing/" title="Cluster Computing" class="md-nav__link">
      Cluster Computing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/Background/The_Scheduler/" title="How the scheduler works" class="md-nav__link">
      How the scheduler works
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17-29" type="checkbox" id="nav-17-29">
    
    <label class="md-nav__link" for="nav-17-29">
      Needs work
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-17-29">
        Needs work
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/needs_work/Managing_Data_on_RC_Systems/" title="Managing Data on RC Systems" class="md-nav__link">
      Managing Data on RC Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/needs_work/Resource_Allocation/" title="Resource Allocation" class="md-nav__link">
      Resource Allocation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/needs_work/Running_Hybrid_OpenMP__MPI_Code/" title="Running Hybrid OpenMP/MPI Code" class="md-nav__link">
      Running Hybrid OpenMP/MPI Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/needs_work/Summary_of_Legion_changes/" title="Summary of Legion changes" class="md-nav__link">
      Summary of Legion changes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17-30" type="checkbox" id="nav-17-30">
    
    <label class="md-nav__link" for="nav-17-30">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-17-30">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17-30-1" type="checkbox" id="nav-17-30-1">
    
    <label class="md-nav__link" for="nav-17-30-1">
      Done
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-17-30-1">
        Done
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/ANSYS/" title="ANSYS Software" class="md-nav__link">
      ANSYS Software
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/ATLAS/" title="ATLAS" class="md-nav__link">
      ATLAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/BEAST/" title="BEAST" class="md-nav__link">
      BEAST
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/CASTEP/" title="CASTEP" class="md-nav__link">
      CASTEP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/FSL/" title="FSL" class="md-nav__link">
      FSL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/FreeSurfer/" title="FreeSurfer" class="md-nav__link">
      FreeSurfer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/MKL/" title="MKL" class="md-nav__link">
      MKL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/OpenBLAS/" title="OpenBLAS" class="md-nav__link">
      OpenBLAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/Quantum_Espresso/" title="Quantum Espresso" class="md-nav__link">
      Quantum Espresso
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/done/R_packages_available_on_Legion/" title="R packages available on Legion" class="md-nav__link">
      R packages available on Legion
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17-30-2" type="checkbox" id="nav-17-30-2">
    
    <label class="md-nav__link" for="nav-17-30-2">
      Unedited
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-17-30-2">
        Unedited
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/unedited/Running_CP2K_on_Legion/" title="Running CP2K on Legion" class="md-nav__link">
      Running CP2K on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/unedited/Running_DL_Poly_4_on_Legion/" title="Running DL Poly 4 on Legion" class="md-nav__link">
      Running DL Poly 4 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/unedited/Running_GROMACS_on_Legion/" title="Running GROMACS on Legion" class="md-nav__link">
      Running GROMACS on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/unedited/Running_Gaussian_09_on_Legion/" title="Running Gaussian 09 on Legion" class="md-nav__link">
      Running Gaussian 09 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/unedited/Running_LAMMPS_on_Legion/" title="Running LAMMPS on Legion" class="md-nav__link">
      Running LAMMPS on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/unedited/Running_ROOT_on_Legion/" title="Running ROOT on Legion" class="md-nav__link">
      Running ROOT on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Wiki_Export/software/unedited/Running_TractoR_on_Legion/" title="Running TractoR on Legion" class="md-nav__link">
      Running TractoR on Legion
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-multi-threaded-batch-jobs" class="md-nav__link">
    Single node multi-threaded batch jobs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-without-the-jvm-to-reduce-overhead" class="md-nav__link">
    Run without the JVM to reduce overhead
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-single-threaded" class="md-nav__link">
    Run single-threaded
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-matlab-gui-interactively" class="md-nav__link">
    Using the MATLAB GUI interactively
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submitting-jobs-using-the-distributed-computing-server-dcs" class="md-nav__link">
    Submitting jobs using the Distributed Computing Server (DCS)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importing-the-cluster-profile" class="md-nav__link">
    Importing the cluster profile
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-using-matlab-functions" class="md-nav__link">
    Import using MATLAB functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-from-matlab-gui" class="md-nav__link">
    Import from MATLAB GUI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables-needed-for-job-submission" class="md-nav__link">
    Environment variables needed for job submission
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-a-simple-dcs-job" class="md-nav__link">
    Example: a simple DCS job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-a-dcs-job-with-more-than-one-input-file" class="md-nav__link">
    Example: a DCS job with more than one input file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    Further reading
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submitting-matlab-jobs-from-your-workstationlaptop" class="md-nav__link">
    Submitting MATLAB jobs from your workstation/laptop
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-setup" class="md-nav__link">
    Remote setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submitting-a-job-to-the-cluster" class="md-nav__link">
    Submitting a job to the cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-your-results" class="md-nav__link">
    Viewing your results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-intermediate-results" class="md-nav__link">
    Writing intermediate results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-remote-jobs" class="md-nav__link">
    Troubleshooting remote jobs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-matlab-on-gpus" class="md-nav__link">
    Running MATLAB on GPUs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/UCL-RITS/mkdocs-rc-docs/blob/master/mkdocs-project-dir/docs/Software_Guides/Matlab.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>MATLAB</h1>
                
                <p>MATLAB is a numerical computing environment and proprietary programming language developed by MathWorks.</p>
<p>Our MATLAB installs include all the toolboxes included in UCL's Total Academic Headcount-Campus licence plus the Matlab Distributed Computing Server. We also have the NAG toolbox for Matlab available.</p>
<p>You can submit single node multi-threaded MATLAB jobs or single node jobs which use the Parallel Computing Toolbox and Matlab's Distributed Computing Server. Please note that these currently will not work across multiple nodes, so all types of MATLAB jobs can only use one node.</p>
<p>You can submit jobs to Myriad and Legion from MATLAB running on your own desktop or laptop.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">§</a></h2>
<p>You need to load MATLAB once from a login node before you can submit any jobs. This allows it to set up your <code>~/.matlab</code> directory as a symbolic link to <code>~/Scratch/.matlab</code> so that the compute nodes can write to it.</p>
<div class="codehilite"><pre><span></span># on a login node
module load xorg-utils/X11R7.7
module load matlab/full/r2018b/9.5
</pre></div>


<p>You can run <code>module avail matlab</code> to see all the available installed versions.</p>
<h2 id="single-node-multi-threaded-batch-jobs">Single node multi-threaded batch jobs<a class="headerlink" href="#single-node-multi-threaded-batch-jobs" title="Permanent link">§</a></h2>
<p>This is the simplest way to start using MATLAB on the cluster.</p>
<p>You will need a .m file containing the MATLAB commands you want to carry out.</p>
<p>Here is an example jobscript which you would submit using the <code>qsub</code> command, after you have loaded the MATLAB module once on a login node as mentioned in <a href="#setup">Setup</a>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run a multi-threaded MATLAB job under SGE.

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM per core. 
#$ -l mem=1G

# Request 15 gigabytes of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Request a number of threads (which will use that number of cores). 
# On Myriad you can set the number of threads to a maximum of 36. 
#$ -pe smp 36

# Request one MATLAB licence - makes sure your job doesn&#39;t start 
# running until sufficient licenses are free.
#$ -l matlab=1

# Set the name of the job.
#$ -N Matlab_multiThreadedJob1

# Set the working directory to somewhere in your scratch space.
# This is a necessary step as compute nodes cannot write to $HOME.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID.
# This directory must already exist.
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/Matlab_examples

# Your work should be done in $TMPDIR
cd $TMPDIR

module load xorg-utils/X11R7.7
module load matlab/full/r2018b/9.5
# outputs the modules you have loaded
module list

# Optional: copy your script and any other files into $TMPDIR.
# This is only practical if you have a small number of files.
# If you do not copy them in, you must always refer to them using a
# full path so they can be found, eg. ~/Scratch/Matlab_examples/analyse.m

cp ~/Scratch/Matlab_examples/myMatlabJob.m $TMPDIR
cp ~/Scratch/Matlab_examples/initialise.m $TMPDIR
cp ~/Scratch/Matlab_examples/analyse.m $TMPDIR

# These echoes output what you are about to run
echo &quot;&quot;
echo &quot;Running matlab -nosplash -nodisplay &lt; myMatlabJob.m ...&quot;
echo &quot;&quot;

matlab -nosplash -nodesktop -nodisplay &lt; myMatlabJob.m
# Or if you did not copy your files:
# matlab -nosplash -nodesktop -nodisplay &lt; ~/Scratch/Matlab_examples/myMatlabJob.m

# tar up all contents of $TMPDIR back into your space
tar zcvf $HOME/Scratch/Matlab_examples/files_from_job_${JOB_ID}.tgz $TMPDIR

# Make sure you have given enough time for the copy to complete!
</pre></div>
</td></tr></table>

<p>Alternative syntax:
Instead of using Unix input redirection like this:</p>
<div class="codehilite"><pre><span></span>matlab -nosplash -nodesktop -nodisplay &lt; $Matlab_infile
</pre></div>


<p>you can also do:</p>
<div class="codehilite"><pre><span></span>matlab -nosplash -nodesktop -nodisplay -r $Matlab_infile
</pre></div>


<h3 id="run-without-the-jvm-to-reduce-overhead">Run without the JVM to reduce overhead<a class="headerlink" href="#run-without-the-jvm-to-reduce-overhead" title="Permanent link">§</a></h3>
<p>You can give the <code>-nojvm</code> option to tell MATLAB to run without the Java Virtual Machine. This will speed up startup time, possibly execution time, and remove some memory overhead, but will prevent you using any tools that require Java (eg, tools that use the Java API for I/O and networking like URLREAD, or call Java object methods). </p>
<h3 id="run-single-threaded">Run single-threaded<a class="headerlink" href="#run-single-threaded" title="Permanent link">§</a></h3>
<p>Most of the time, MATLAB will create many threads and use them as it wishes. If you know your job is entirely single-threaded, you can force MATLAB to run with only one thread on one core, which will allow you to have more jobs running at once. </p>
<p>To request one core only, set <code>#$ -pe smp 1</code> in your jobscript.</p>
<p>Run MATLAB like this:</p>
<div class="codehilite"><pre><span></span>matlab -nosplash -nodesktop -nodisplay -nojvm -singleCompThread &lt; $Matlab_infile
</pre></div>


<p>The <code>-singleCompThread</code> forces MATLAB to run single-threaded, and the <code>-nojvm</code> tells it to run without the Java Virtual Machine, as above. </p>
<h2 id="using-the-matlab-gui-interactively">Using the MATLAB GUI interactively<a class="headerlink" href="#using-the-matlab-gui-interactively" title="Permanent link">§</a></h2>
<p>You can run MATLAB interactively for short amounts of time on the login nodes (please do not do this if your work will be resource-intensive). You can also run it interactively in a <code>qrsh</code> session on the compute nodes.</p>
<p>Launching with <code>matlab</code> will give you the full graphical user interface - you will need to have logged in to the cluster with X-forwarding on for this to work. </p>
<p>Launching with <code>matlab -nodesktop -nodisplay</code> will give you the MATLAB terminal.</p>
<h2 id="submitting-jobs-using-the-distributed-computing-server-dcs">Submitting jobs using the Distributed Computing Server (DCS)<a class="headerlink" href="#submitting-jobs-using-the-distributed-computing-server-dcs" title="Permanent link">§</a></h2>
<p>You must have loaded the MATLAB module once from a login node as described in <a href="#setup">Setup</a> before you can submit any Matlab DCS jobs.</p>
<p>MATLAB DCS jobs must be submitted from an interactive or scripted Matlab session which can be running on the cluster login nodes or on your own machine.</p>
<p>MATLAB DCS jobs will only work inside a single node on our clusters. On Myriad this means a maximum of 36 workers can be used per job.</p>
<h3 id="importing-the-cluster-profile">Importing the cluster profile<a class="headerlink" href="#importing-the-cluster-profile" title="Permanent link">§</a></h3>
<p>You need to import the cluster profile into your MATLAB environment and set it as the default before you can submit DCS jobs. This only needs doing once. The imported profile will be saved in your MATLAB settings directory.</p>
<p>Importing the profile can be done either by calling MATLAB functions or via the graphical interface. The profile is stored here (for 2018b): </p>
<div class="codehilite"><pre><span></span>/shared/ucl/apps/Matlab/toolbox_local/Legion/R2018b/LegionGraceMyriadProfile_R2018b.settings
</pre></div>


<h4 id="import-using-matlab-functions">Import using MATLAB functions<a class="headerlink" href="#import-using-matlab-functions" title="Permanent link">§</a></h4>
<p>Run these functions from a MATLAB session:</p>
<div class="codehilite"><pre><span></span>profile_Legion = parallel.importProfile (&#39;/shared/ucl/apps/Matlab/toolbox_local/Legion/R2018b/LegionGraceMyriadProfile_R2018b.settings&#39;);
parallel.defaultClusterProfile (&#39;LegionGraceMyriadProfileR2018b&#39;);
</pre></div>


<h4 id="import-from-matlab-gui">Import from MATLAB GUI<a class="headerlink" href="#import-from-matlab-gui" title="Permanent link">§</a></h4>
<p>To import using the graphical interface instead, do this.</p>
<ol>
<li>From the Home tab select the Parallel menu and click <em>Create and Manage Clusters...</em>.</li>
<li>The Cluster Profile Manager window will open.
<img alt="MATLAB Cluster Profile Manager screenshot" src="../../img/MATLAB_ClusterProfBefore.png" /></li>
<li>Select Import and in the <em>Import Profiles from file</em> window navigate to the LegionGraceMyriadProfile_R2018b.settings file shown above and select Open.</li>
<li>Select the resulting LegionGraceMyriadProfileR2018b profile and click <em>Set as Default</em>. The Cluster Profile Manager window should now look like this:
<img alt="MATLAB Cluster Profile Manager screenshot after" src="../../img/MATLAB_ClusterProfAfter_R2018b.png" /></li>
</ol>
<p>In both cases after you exit MATLAB your cluster profile is saved for future use.</p>
<h4 id="environment-variables-needed-for-job-submission">Environment variables needed for job submission<a class="headerlink" href="#environment-variables-needed-for-job-submission" title="Permanent link">§</a></h4>
<p>We have set up three Grid Engine environment variables to assist with job submission from within MATLAB. These are needed to pass in job resource parameters that aren't supported by the internal MATLAB job submission mechanism.</p>
<ul>
<li><code>SGE_CONTEXT</code>: a comma-separated list of variables treated as if added via the <code>-ac</code> option, eg. <code>exclusive</code></li>
<li><code>SGE_OPT</code>: a comma-separated list of resources treated as if added via the <code>-l</code> option, eg. <code>h_rt=0:10:0,mem=1G,tmpfs=15G</code></li>
<li><code>SGE_PROJECT</code>: a project treated as if added via the <code>-P</code> option (not normally needed).</li>
</ul>
<p><code>-ac exclusive</code> prevents anything else running on the same node as your job, even if you aren't using all the cores. This is no longer a necessary option for MATLAB jobs.</p>
<p>There are two ways to set these:</p>
<p>1) Before starting your MATLAB session, using the usual Bash method of exporting environment variables:</p>
<div class="codehilite"><pre><span></span>export SGE_CONTEXT=exclusive
export SGE_OPT=h_rt=0:15:0,mem=2G,tmpfs=15G
export SGE_PROJECT=&lt;your project ID&gt;
</pre></div>


<p>2) Inside your MATLAB session, using MATLAB's <code>setenv</code> function:</p>
<div class="codehilite"><pre><span></span>setenv (&#39;SGE_CONTEXT&#39;, &#39;exclusive&#39;);
setenv (&#39;SGE_OPT&#39;, &#39;h_rt=0:15:0,mem=2G,tmpfs=15G&#39;); 
setenv (&#39;SGE_PROJECT&#39;, &#39;&lt;your project ID&gt;&#39;);
</pre></div>


<h4 id="example-a-simple-dcs-job">Example: a simple DCS job<a class="headerlink" href="#example-a-simple-dcs-job" title="Permanent link">§</a></h4>
<p>This submits a job from inside a MATLAB session running on a login node. You need to start MATLAB from a directory in Scratch - jobs will inherit this as their working directory.</p>
<p>This is an example where you have only one MATLAB source file.</p>
<p>1) Change to the directory in Scratch you want the job to run from and set the SGE environment variables.</p>
<div class="codehilite"><pre><span></span>cd ~/Scratch/Matlab_examples
export SGE_OPT=h_rt=0:10:0,mem=1G,tmpfs=15G
</pre></div>


<p>2) Either start the MATLAB GUI:</p>
<div class="codehilite"><pre><span></span>matlab
</pre></div>


<p>or start a MATLAB terminal session:</p>
<div class="codehilite"><pre><span></span>matlab -nodesktop -nodisplay
</pre></div>


<p>3) Inside MATLAB, create a cluster object using the cluster profile:</p>
<div class="codehilite"><pre><span></span>c = parcluster (&#39;LegionGraceMyriadProfileR2018b&#39;);
</pre></div>


<p>4) Use your cluster object to create a job object of the type you need. For this example the job is a parallel job with communication between MATLAB workers of type "Single Program Multiple Data":</p>
<div class="codehilite"><pre><span></span>myJob = createCommunicatingJob (c, &#39;Type&#39;, &#39;SPMD&#39;);
</pre></div>


<p>5) Set the number of workers:</p>
<div class="codehilite"><pre><span></span>num_workers = 36;
</pre></div>


<p>6) Tell the job the files needed to be made available to each worker - in this example there is only one file:</p>
<div class="codehilite"><pre><span></span>myJob.AttachedFiles = {&#39;colsum.m&#39;};
</pre></div>


<p><code>colsum.m</code> contains the simple magic square example from the MATLAB manual "Parallel Computing Toolbox User's Guide". </p>
<p>7) Set the minimum and maximum number of workers for the job (we are asking for an exact number here by setting them the same):</p>
<div class="codehilite"><pre><span></span>myJob.NumWorkersRange = [num_workers, num_workers];
</pre></div>


<p>8) Create a MATLAB task to be executed as part of the job. Here it consists of executing the MATLAB function <code>colsum</code>. The other arguments say that the task returns one parameter and there are no input arguments to the <code>colsum</code> function:</p>
<div class="codehilite"><pre><span></span>task = createTask (myJob, @colsum, 1, {});
</pre></div>


<p>9) Submit the job:</p>
<div class="codehilite"><pre><span></span>submit (myJob);
</pre></div>


<p>Your job is now submitted to the scheduler and you can see its queue status in <code>qstat</code> as normal. If you were using the MATLAB GUI you can also monitor jobs by selecting <em>Monitor Jobs</em> from the <em>Parallel</em> menu on the <em>Home</em> tab.</p>
<p>10) When the job has completed get the results using:</p>
<div class="codehilite"><pre><span></span>results = fetchOutputs(myJob)
</pre></div>


<p>You can access the job log from MATLAB using:</p>
<div class="codehilite"><pre><span></span>logMess = getDebugLog (c, myJob);
</pre></div>


<h4 id="example-a-dcs-job-with-more-than-one-input-file">Example: a DCS job with more than one input file<a class="headerlink" href="#example-a-dcs-job-with-more-than-one-input-file" title="Permanent link">§</a></h4>
<p>This example has several input files. The job type is "MATLAB Pool". A "Pool" job runs the specified task function with a MATLAB pool available to run the body of parfor loops or spmd blocks and is the default job type. This example was kindly supplied to assist in testing MATLAB by colleagues from CoMPLEX. </p>
<p>The first part of creating the job is the same as the above example apart from the longer runtime and larger amount of memory per core: </p>
<p>1)  Change into a directory in Scratch, set the SGE variables and launch MATLAB:</p>
<div class="codehilite"><pre><span></span>cd ~/Scratch/Matlab_examples
export SGE_OPT=h_rt=1:0:0,mem=2G,tmpfs=15G
matlab
</pre></div>


<p>to launch the GUI or:</p>
<div class="codehilite"><pre><span></span>matlab -nodesktop -nodisplay
</pre></div>


<p>to start a terminal session. </p>
<div class="codehilite"><pre><span></span>c = parcluster (&#39;LegionGraceMyriadProfileR2018b&#39;);
</pre></div>


<p>2) Using our cluster object create a job object of type "Pool":</p>
<div class="codehilite"><pre><span></span>myJob2 = createCommunicatingJob (c, &#39;Type&#39;, &#39;Pool&#39;);
</pre></div>


<p>3) Set the number of workers and another variable used by the example:</p>
<div class="codehilite"><pre><span></span>num_workers = 8;
simulation_duration_ms = 1000;
</pre></div>


<p>4) Tell the job all the input files needed to be made available to each worker as a cell array:</p>
<div class="codehilite"><pre><span></span>myJob2.AttachedFiles = {
&#39;AssemblyFiniteDifferencesMatrix.m&#39;
&#39;AssemblyFiniteDifferencesRightHandSide.m&#39;
&#39;CellModelsComputeIonicCurrents.m&#39;
&#39;CellModelsGetVoltage.m&#39;
&#39;CellModelsInitialise.m&#39;
&#39;CellModelsSetVoltage.m&#39;
&#39;GetStimuliForTimeStep.m&#39;
&#39;SubmitMonodomainJob.m&#39;
&#39;RegressionTest.m&#39;
&#39;RunAndVisualiseMonodomainSimulation.m&#39;
&#39;SolveLinearSystem.m&#39;
&#39;luo_rudy_1991_iionic.m&#39;
&#39;luo_rudy_1991_time_deriv.m&#39;};
</pre></div>


<p>5) Set the minimum and maximum number of workers for the job:</p>
<div class="codehilite"><pre><span></span>myJob2.NumWorkersRange = [num_workers, num_workers];
</pre></div>


<p>6) Create a MATLAB task to be executed as part of the job. For this example it will consist of executing the MATLAB function <code>RunAndVisualiseMonodomainSimulation</code>. The rest of the arguments indicate that the task returns three parameters and there are five input arguments to the function. These are passed as a cell array:</p>
<div class="codehilite"><pre><span></span>task = createTask (myJob2, @RunAndVisualiseMonodomainSimulation, 3, {5000, simulation_duration_ms, 1.4, 1.4, false});
</pre></div>


<p>7) Submit the job:</p>
<div class="codehilite"><pre><span></span>submit (myJob2);
</pre></div>


<p>As before use <code>fetchOutputs</code> to collect the results.</p>
<p>If you closed your session, you can get your results by:</p>
<div class="codehilite"><pre><span></span>c = parcluster (&#39;LegionGraceMyriadProfileR2018b&#39;); # get a cluster object
jobs = findJob(c)                                  # get a list of jobs submitted to that cluster
job = jobs(3);                                     # pick a particular job
results = fetchOutputs(job)
</pre></div>


<p>You can get other information: <code>diary(job)</code> will give you the job diary, and <code>load(job)</code> will load the workspace. </p>
<h4 id="further-reading">Further reading<a class="headerlink" href="#further-reading" title="Permanent link">§</a></h4>
<p>There is a lot more information about using the MATLAB Distributed Computing Server in the MATLAB manual: <a href="https://uk.mathworks.com/help/distcomp/index.html">Parallel Computing Toolbox User’s Guide</a>.</p>
<h2 id="submitting-matlab-jobs-from-your-workstationlaptop">Submitting MATLAB jobs from your workstation/laptop<a class="headerlink" href="#submitting-matlab-jobs-from-your-workstationlaptop" title="Permanent link">§</a></h2>
<p>You can submit MATLAB jobs to Myriad and Legion from MATLAB sessions running on your own desktop workstation or laptop systems provided they are running the same version of MATLAB and your computer is within the UCL firewall. </p>
<p>With MATLAB R2018b you can currently submit jobs to Myriad and Legion. Older versions (R2016b and R2018a) can be used to submit jobs to Legion only, if you still have an account. </p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">§</a></h3>
<ol>
<li>You must already have an account on the clusters!</li>
<li>Have MATLAB R2018b installed on your local workstation/laptop. The local version must match the version running jobs. MATLAB R2018b can be downloaded from the <a href="http://swdb.ucl.ac.uk/package/view/id/2?filter=Matlab">UCL Software Database</a>.</li>
<li>Your local workstation/laptop installation of MATLAB must include the Parallel Computing toolbox. This is included in the UCL TAH MATLAB license and may be installed automatically.</li>
<li>If your local workstation/laptop is not directly connected to the UCL network (at home for example), you need to have the <a href="https://www.ucl.ac.uk/isd/services/get-connected/remote-working-services/ucl-virtual-private-network-vpn">UCL VPN client</a> installed and running on it.</li>
</ol>
<h3 id="remote-setup">Remote setup<a class="headerlink" href="#remote-setup" title="Permanent link">§</a></h3>
<p>1) On the cluster you are using (Myriad or Legion) create a directory to hold remotely submitted job details. For example:</p>
<div class="codehilite"><pre><span></span>mkdir ~/Scratch/Matlab_remote_jobs
</pre></div>


<p>This directory needs to be in your Scratch directory as compute nodes need to be able to write to it. You should not use this directory for anything else.</p>
<p>2) On your local workstation/laptop create a directory to hold information about jobs that have been submitted to the cluster. Again you should not use this directory for anything else.</p>
<p>3) Download the <a href="../matlab_resources/Myriad_submit_R2018b.zip">support files for remote submission to Myriad and Legion for R2018b</a> or <a href="../matlab_resources/Legion_submit_R2018a.zip">support files for remote submission to Legion only for R2018a</a>. Make sure you download the correct one for your version of MATLAB!</p>
<p>4) This step <strong>MUST</strong> be done while Matlab is shut down. Unzip the archive into MATLAB's local toolbox directory. Default locations for the local toolbox directory are:</p>
<ul>
<li>Linux:
The default local toolbox location is <code>/usr/local/MATLAB/R2018b/toolbox/local</code> for R2018b. Navigate to this directory and use <code>unzip -x archive_name</code>. </li>
<li>Mac OS X:
The default local toolbox location is <code>/Applications/MATLAB_R2018b.app/toolbox/local</code> for R2018b. In order to view or change the contents of an application package, open <code>/Applications</code> in a Finder window. Then right-click the application and select "View Package Contents." Then navigate to the appropriate directory. Note: if you don't have access to <code>/Applications/MATLAB_R2018b.app/toolbox/local</code>, you can unzip the support files into <code>~/Documents/MATLAB/</code> instead. </li>
<li>Windows:
The default local toolbox location is <code>C:\Program Files\MATLAB\R2018b\toolbox\local</code> for R2018b. Extract the archive here. You can unzip the support files into <code>Documents\MATLAB\</code> instead.</li>
</ul>
<p>5) Download the <a href="../matlab_resources/ParallelProfileMyriad.m.zip">parallelProfileMyriad function</a> or the <a href="../matlab_resources/ParallelProfileLegion.m.zip">parallelProfileLegion function</a> to your local workstation/laptop. It will need to be unzipped. These functions create a cluster profile for Myriad or Legion.</p>
<p>6) Start MATLAB, navigate to where you saved the <code>parallelProfileMyriad.m</code> or <code>parallelProfileLegion.m</code> files and run the function by typing:</p>
<div class="codehilite"><pre><span></span>parallelProfileMyriad
</pre></div>


<p>or:</p>
<div class="codehilite"><pre><span></span>parallelProfileLegion
</pre></div>


<p>at your MATLAB prompt (in your MATLAB Command Window if running the MATLAB GUI) and answer the questions.</p>
<h3 id="submitting-a-job-to-the-cluster">Submitting a job to the cluster<a class="headerlink" href="#submitting-a-job-to-the-cluster" title="Permanent link">§</a></h3>
<p>1) You need to set the <a href="#environment-variables-needed-for-job-submission">Grid Engine support environment variables</a> on your local computer.
Eg. in your MATLAB session set:</p>
<div class="codehilite"><pre><span></span>setenv (&#39;SGE_CONTEXT&#39;, &#39;exclusive&#39;);                # optional
setenv (&#39;SGE_OPT&#39;, &#39;h_rt=0:15:0,mem=2G,tmpfs=15G&#39;); 
setenv (&#39;SGE_PROJECT&#39;, &#39;&lt;your project ID&gt;&#39;);        # optional
</pre></div>


<p>2) In your MATLAB session create a cluster object using the cluster profile created by the <code>parallelProfile...</code> functions. For Myriad:</p>
<div class="codehilite"><pre><span></span>c = parcluster (&#39;myriad_R2018b&#39;);
</pre></div>


<p>For Legion the profile is called <code>legion_R2018b</code>.</p>
<p>3) You can now create and submit jobs in a similar way to that shown in the DCS examples above starting from step 4 in the <a href="#example-a-simple-dcs-job">simple DCS job example</a> or step 2 in the <a href="#example-a-dcs-job-with-more-than-one-input-file">DCS job with multiple input files example</a>.</p>
<h3 id="viewing-your-results">Viewing your results<a class="headerlink" href="#viewing-your-results" title="Permanent link">§</a></h3>
<p>After submitting your job remotely from your desktop, you can close MATLAB and come back later. To see your jobs:</p>
<p>Click "Parallel &gt; Monitor jobs"</p>
<p>This will bring up the job monitor where you can see the status of your jobs and whether they are finished. MATLAB numbers the jobs sequentially.</p>
<p>Right-click on a job and choose "fetch outputs".</p>
<p>This is what will be executed (for job4 on Myriad):</p>
<div class="codehilite"><pre><span></span>myCluster = parcluster(&#39;myriad_R2018b&#39;);
job4 = myCluster.findJob(&#39;ID&#39;,4);
job4_output = fetchOutputs(job4);
</pre></div>


<p>The Workspace will show the available data and you can view your results. The data is fetched from the <code>Matlab_remote_jobs</code> directory you created on Myriad (or Legion) in <a href="#remote-setup">Remote setup</a> step 1, so that will also have files and directories in it called job1, job2 and so on.</p>
<p>If you have already fetched the data, you can view the results straight away by selecting that job. If you need to reload everything, you can right-click on the job and the option will be to load variables instead. </p>
<h4 id="writing-intermediate-results">Writing intermediate results<a class="headerlink" href="#writing-intermediate-results" title="Permanent link">§</a></h4>
<p>If you want to explicitly write out intermediate results, you need to provide a full path to somewhere in Scratch otherwise MATLAB will try to write them in your home, which isn't writable by the compute nodes. </p>
<h3 id="troubleshooting-remote-jobs">Troubleshooting remote jobs<a class="headerlink" href="#troubleshooting-remote-jobs" title="Permanent link">§</a></h3>
<p>If you get a message like this when retrieving your outputs then something has gone wrong in your job:</p>
<div class="codehilite"><pre><span></span>Task with ID xxx returned 0 outputs but 1 were expected
</pre></div>


<p>You need to retrieve the debug log to find out what happened. Example:</p>
<div class="codehilite"><pre><span></span>myCluster = parcluster(&#39;myriad_R2018b&#39;);
job4 = myCluster.findJob(&#39;ID&#39;,4);

jobLog = getDebugLog (myCluster, job4);
jobLog
</pre></div>


<p>There will be a lot of output. Look for lines related to errors happening in your own code.</p>
<h2 id="running-matlab-on-gpus">Running MATLAB on GPUs<a class="headerlink" href="#running-matlab-on-gpus" title="Permanent link">§</a></h2>
<p>This uses MATLAB's <a href="https://uk.mathworks.com/help/distcomp/examples/illustrating-three-approaches-to-gpu-computing-the-mandelbrot-set.html">Mandelbrot Set GPU example</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run a GPU MATLAB job on Myriad.

# Request 15 minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:15:0

# Request 2 gigabytes of RAM per core.
#$ -l mem=2G

# Request 15 gigabytes of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Request 1 GPU
#$ -l gpu=1

# Request 1 CPU core. (Max on Myriad is 36)
#$ -pe smp 1

# Request one MATLAB licence - makes sure your job doesn&#39;t start 
# running until sufficient licenses are free.
#$ -l matlab=1

# Set the name of the job.
#$ -N Matlab_GPU_Job1

# Set the working directory to somewhere in your scratch space.
# This is a necessary step as compute nodes cannot write to $HOME.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID.
# This directory must already exist.
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/Matlab_examples

# Your work should be done in $TMPDIR
cd $TMPDIR

# Optional: Copy your script and any other files into $TMPDIR.
# If not, you must always refer to them using a full path.
cp /home/ccaabaa/Software/Matlab/Mandelbrot_GPU.m $TMPDIR

module unload compilers mpi
module load compilers/gnu/4.9.2
module load xorg-utils/X11R7.7
module load matlab/full/r2018b/9.5
module list

# These echoes output what you are about to run
echo &quot;&quot;
echo &quot;Running matlab -nosplash -nodisplay &lt; Mandelbrot_GPU.m ...&quot;
echo &quot;&quot;
matlab -nosplash -nodesktop -nodisplay &lt; Mandelbrot_GPU.m

# tar up all contents of $TMPDIR back into your space
tar zcvf $HOME/Scratch/Matlab_examples/files_from_job_${JOB_ID}.tgz $TMPDIR

# Make sure you have given enough time for the copy to complete!
</pre></div>
</td></tr></table>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../Paid-For_Resources/Purchasing_in_Myriad/" title="Purchasing in Myriad" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Purchasing in Myriad
              </span>
            </div>
          </a>
        
        
          <a href="../Singularity/" title="Singularity" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Singularity
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2014 - 2020 UCL Research Computing Group
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/UCL-RITS" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>