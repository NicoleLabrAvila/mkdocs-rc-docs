



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the centrally provided Research Computing HPC services at UCL.">
      
      
        <link rel="canonical" href="http://rits.github-pages.ucl.ac.uk/mkdocs-rc-docs/Wiki_Export/Example_Submission_Scripts/">
      
      
        <meta name="author" content="UCL RCAS Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.3.0">
    
    
      
        <title>Example Submission Scripts</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#service-differences" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://rits.github-pages.ucl.ac.uk/mkdocs-rc-docs/" title="UCL Research Computing Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../img/portico.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                UCL Research Computing Documentation
              </span>
              <span class="md-header-nav__topic">
                Example Submission Scripts
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/UCL-RITS/mkdocs-rc-docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      UCL-RITS/mkdocs-rc-docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://rits.github-pages.ucl.ac.uk/mkdocs-rc-docs/" title="UCL Research Computing Documentation" class="md-nav__button md-logo">
      
        <img src="../../img/portico.svg" width="48" height="48">
      
    </a>
    UCL Research Computing Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/UCL-RITS/mkdocs-rc-docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      UCL-RITS/mkdocs-rc-docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../howto/" title="How do I?" class="md-nav__link">
      How do I?
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Wiki Export
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Wiki Export
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Research Computing Services" class="md-nav__link">
      Research Computing Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Accessing_RC_Systems/" title="Accessing RC Systems" class="md-nav__link">
      Accessing RC Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Account_Services/" title="Account Services" class="md-nav__link">
      Account Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Acknowledging_RC_Systems/" title="Acknowledging the Use of RC Systems" class="md-nav__link">
      Acknowledging the Use of RC Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Additional_Resource_Requests/" title="Additional Resource Requests" class="md-nav__link">
      Additional Resource Requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Aristotle/" title="Aristotle" class="md-nav__link">
      Aristotle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Batch_Processing/" title="Batch Processing" class="md-nav__link">
      Batch Processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Building_and_Running_Matlab_Programs/" title="Building and Running Matlab Programs" class="md-nav__link">
      Building and Running Matlab Programs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Cluster_Computing/" title="Cluster Computing" class="md-nav__link">
      Cluster Computing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Compiling/" title="Compiling your code" class="md-nav__link">
      Compiling your code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Connecting_to_Research_Data_Services/" title="Connecting to Research Data Services" class="md-nav__link">
      Connecting to Research Data Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Contact_and_Support/" title="Contact and Support" class="md-nav__link">
      Contact and Support
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Example Submission Scripts
      </label>
    
    <a href="./" title="Example Submission Scripts" class="md-nav__link md-nav__link--active">
      Example Submission Scripts
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-differences" title="Service Differences" class="md-nav__link">
    Service Differences
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-directories-and-output" title="Working Directories and Output" class="md-nav__link">
    Working Directories and Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-about-projects" title="Note about Projects" class="md-nav__link">
    Note about Projects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serial-job-script-example" title="Serial Job Script Example" class="md-nav__link">
    Serial Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-threaded-job-example" title="Multi-threaded Job Example" class="md-nav__link">
    Multi-threaded Job Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi-job-script-example" title="MPI Job Script Example" class="md-nav__link">
    MPI Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example" title="Array Job Script Example" class="md-nav__link">
    Array Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example-using-parameter-file" title="Array Job Script Example Using Parameter File" class="md-nav__link">
    Array Job Script Example Using Parameter File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-array-job-using-local2scratch" title="Example Array Job Using Local2Scratch" class="md-nav__link">
    Example Array Job Using Local2Scratch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-with-a-stride" title="Array Job Script with a Stride" class="md-nav__link">
    Array Job Script with a Stride
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpu-job-script-example" title="GPU Job Script Example" class="md-nav__link">
    GPU Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-using-mpi-and-gpus" title="Job using MPI and GPUs" class="md-nav__link">
    Job using MPI and GPUs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQ/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GPU_Clusters/" title="GPU clusters" class="md-nav__link">
      GPU clusters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GPU_Nodes/" title="GPU nodes" class="md-nav__link">
      GPU nodes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Installing_PGI/" title="Installing PGI" class="md-nav__link">
      Installing PGI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Interactive_Jobs/" title="Interactive Job Sessions" class="md-nav__link">
      Interactive Job Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Known_Issues/" title="Known Issues" class="md-nav__link">
      Known Issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Michael/" title="Michael" class="md-nav__link">
      Michael
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Myriad/" title="Myriad" class="md-nav__link">
      Myriad
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../News_and_Events/" title="News and Events" class="md-nav__link">
      News and Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Paid-For_Resources/" title="Paid-For Resources" class="md-nav__link">
      Paid-For Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Planned_Service_Outages/" title="Planned Service Outages" class="md-nav__link">
      Planned Service Outages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Points_of_Contact/" title="Points of Contact" class="md-nav__link">
      Points of Contact
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Quick_Start/" title="Legion Quick Start" class="md-nav__link">
      Legion Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RC_Systems/" title="Research Computing Platforms" class="md-nav__link">
      Research Computing Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RC_Systems_user_environment/" title="RC Systems user environment" class="md-nav__link">
      RC Systems user environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Reporting_problems/" title="Reporting problems" class="md-nav__link">
      Reporting problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Research_Computing_Glossary/" title="Research Computing Glossary" class="md-nav__link">
      Research Computing Glossary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Terms_and_Conditions/" title="Terms and Conditions" class="md-nav__link">
      Terms and Conditions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../The_Scheduler/" title="How the scheduler works" class="md-nav__link">
      How the scheduler works
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Thomas/" title="Thomas" class="md-nav__link">
      Thomas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Training/" title="Training" class="md-nav__link">
      Training
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../UCL_UK_e-Science_Certificates/" title="UCL UK e-Science Certificates" class="md-nav__link">
      UCL UK e-Science Certificates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../User_Scripts/" title="User Scripts" class="md-nav__link">
      User Scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../X11_Forwarding_with_Windows/" title="X11 Forwarding With Windows" class="md-nav__link">
      X11 Forwarding With Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-39" type="checkbox" id="nav-3-39">
    
    <label class="md-nav__link" for="nav-3-39">
      Needs work
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-39">
        Needs work
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../needs_work/Managing_Data_on_RC_Systems/" title="Managing Data on RC Systems" class="md-nav__link">
      Managing Data on RC Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../needs_work/Resource_Allocation/" title="Resource Allocation" class="md-nav__link">
      Resource Allocation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../needs_work/Running_Hybrid_OpenMP__MPI_Code/" title="Running Hybrid OpenMP/MPI Code" class="md-nav__link">
      Running Hybrid OpenMP/MPI Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../needs_work/Summary_of_Legion_changes/" title="Summary of Legion changes" class="md-nav__link">
      Summary of Legion changes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-40" type="checkbox" id="nav-3-40">
    
    <label class="md-nav__link" for="nav-3-40">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-40">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-40-1" type="checkbox" id="nav-3-40-1">
    
    <label class="md-nav__link" for="nav-3-40-1">
      Done
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-40-1">
        Done
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/ANSYS/" title="ANSYS Software" class="md-nav__link">
      ANSYS Software
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/ATLAS/" title="ATLAS" class="md-nav__link">
      ATLAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/BEAST/" title="BEAST" class="md-nav__link">
      BEAST
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/CASTEP/" title="CASTEP" class="md-nav__link">
      CASTEP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/FSL/" title="FSL" class="md-nav__link">
      FSL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/FreeSurfer/" title="FreeSurfer" class="md-nav__link">
      FreeSurfer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/MKL/" title="MKL" class="md-nav__link">
      MKL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/OpenBLAS/" title="OpenBLAS" class="md-nav__link">
      OpenBLAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/Quantum_Espresso/" title="Quantum Espresso" class="md-nav__link">
      Quantum Espresso
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/done/R_packages_available_on_Legion/" title="R packages available on Legion" class="md-nav__link">
      R packages available on Legion
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-40-2" type="checkbox" id="nav-3-40-2">
    
    <label class="md-nav__link" for="nav-3-40-2">
      Unedited
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-40-2">
        Unedited
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_CP2K_on_Legion/" title="Running CP2K on Legion" class="md-nav__link">
      Running CP2K on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_DL_Poly_4_on_Legion/" title="Running DL Poly 4 on Legion" class="md-nav__link">
      Running DL Poly 4 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_DL_Poly_Classic_1.2_on_Legion/" title="Running DL Poly Classic 1.2 on Legion" class="md-nav__link">
      Running DL Poly Classic 1.2 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_DL_Poly_Classic_1.9_on_Legion/" title="Running DL Poly Classic 1.9 on Legion" class="md-nav__link">
      Running DL Poly Classic 1.9 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_DTI-TK_on_Legion/" title="Running DTI-TK on Legion" class="md-nav__link">
      Running DTI-TK on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_GROMACS_on_Legion/" title="Running GROMACS on Legion" class="md-nav__link">
      Running GROMACS on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_GaussView_5_on_Legion/" title="Running GaussView 5 on Legion" class="md-nav__link">
      Running GaussView 5 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_Gaussian_03_on_Legion/" title="Running Gaussian 03 on Legion" class="md-nav__link">
      Running Gaussian 03 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_Gaussian_09_on_Legion/" title="Running Gaussian 09 on Legion" class="md-nav__link">
      Running Gaussian 09 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_LAMMPS_on_Legion/" title="Running LAMMPS on Legion" class="md-nav__link">
      Running LAMMPS on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_ROOT_on_Legion/" title="Running ROOT on Legion" class="md-nav__link">
      Running ROOT on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_R_3.0.1_on_Legion/" title="Running R 3.0.1 on Legion" class="md-nav__link">
      Running R 3.0.1 on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_SPM_on_Legion/" title="Running SPM on Legion" class="md-nav__link">
      Running SPM on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_StarCCM%2B_on_Legion/" title="Running StarCCM+ on Legion" class="md-nav__link">
      Running StarCCM+ on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_StarCD_on_Legion/" title="Running StarCD on Legion" class="md-nav__link">
      Running StarCD on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_Stata__MP_on_Legion/" title="Running Stata/MP on Legion" class="md-nav__link">
      Running Stata/MP on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_TopHat_on_Legion/" title="Running TopHat on Legion" class="md-nav__link">
      Running TopHat on Legion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../software/unedited/Running_TractoR_on_Legion/" title="Running TractoR on Legion" class="md-nav__link">
      Running TractoR on Legion
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-differences" title="Service Differences" class="md-nav__link">
    Service Differences
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-directories-and-output" title="Working Directories and Output" class="md-nav__link">
    Working Directories and Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-about-projects" title="Note about Projects" class="md-nav__link">
    Note about Projects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serial-job-script-example" title="Serial Job Script Example" class="md-nav__link">
    Serial Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-threaded-job-example" title="Multi-threaded Job Example" class="md-nav__link">
    Multi-threaded Job Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi-job-script-example" title="MPI Job Script Example" class="md-nav__link">
    MPI Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example" title="Array Job Script Example" class="md-nav__link">
    Array Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example-using-parameter-file" title="Array Job Script Example Using Parameter File" class="md-nav__link">
    Array Job Script Example Using Parameter File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-array-job-using-local2scratch" title="Example Array Job Using Local2Scratch" class="md-nav__link">
    Example Array Job Using Local2Scratch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-with-a-stride" title="Array Job Script with a Stride" class="md-nav__link">
    Array Job Script with a Stride
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpu-job-script-example" title="GPU Job Script Example" class="md-nav__link">
    GPU Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-using-mpi-and-gpus" title="Job using MPI and GPUs" class="md-nav__link">
    Job using MPI and GPUs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/UCL-RITS/mkdocs-rc-docs/blob/master/mkdocs-project-dir/docs/Wiki_Export/Example_Submission_Scripts.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Example Submission Scripts</h1>
                
                <p>On this page we describe some basic example scripts to submit jobs to
Legion or Grace.</p>
<p>For a full description of data management policies, please refer to the
<a href="Managing_Data_on_RC_Systems">data management section</a> of
the user guide.</p>
<p>After creating your script, submit it to the scheduler with:</p>
<p><code>qsub my_script.sh</code></p>
<h2 id="service-differences">Service Differences<a class="headerlink" href="#service-differences" title="Permanent link">&para;</a></h2>
<p>These scripts are all applicable to
<a href="RC_Systems#Legion">Legion</a>, <a href="RC_Systems#Grace">Grace</a>, <a href="RC_Systems#Myriad">Myriad</a>, <a href="Thomas">Thomas</a>, and <a href="Michael">Michael</a>,
but node sizes (core count, memory, and temporary storage sizes) differ
between the different machines, and Grace and Thomas are more suited to
MPI and hybrid MPI/OpenMP jobs.</p>
<h2 id="working-directories-and-output">Working Directories and Output<a class="headerlink" href="#working-directories-and-output" title="Permanent link">&para;</a></h2>
<p>The parallel filesystems we use to provide the home and scratch filesystems perform best when reading or writing single large files, and worst when operating on many different small files. To avoid causing problems, many of the scripts below are written to create all their files in the temporary TMPDIR storage, and compress and copy them to the scratch area at the end of the job.</p>
<p>This can be a problem if your job is not finishing and you need to see the output, or if your job is crashing or failing to produce what you expected. Feel free to modify the scripts to read from or write to scratch directly, however, your performance will generally not be as good as writing to TMPDIR, and you may impact the general performance of the machine if you do this with many jobs simultaneously.</p>
<p>Note that there is also the option of using the <code>Local2Scratch</code> process 
(<a href="#Example Serial Job Using Local2Scratch">see below</a>), which takes place <em>after</em> the
job has finished, in the clean-up step. This gives you the option of always
getting the contents of TMPDIR back, at the cost of possibly getting incomplete
files and not having any control over where the files go.</p>
<h2 id="note-about-projects">Note about Projects<a class="headerlink" href="#note-about-projects" title="Permanent link">&para;</a></h2>
<p>Projects are a system used in the scheduler and the accounting system 
to track budgets and access controls.</p>
<p>The majority of users of UCL's internal clusters - Legion, Grace, and 
Myriad - will not need to specify a project and will default to the AllUsers 
project. Users of the Thomas and Michael services should refer to the specific 
pages for those machines, and the information they were given when they registered.</p>
<p>To specify a project ID in a job script, use the <code>-P</code> object as below:</p>
<div class="codehilite"><pre><span></span>#$ -P &lt;your_project_id&gt;
</pre></div>


<h2 id="serial-job-script-example">Serial Job Script Example<a class="headerlink" href="#serial-job-script-example" title="Permanent link">&para;</a></h2>
<p>The most basic type of job a user can submit to the Legion cluster is a serial job. These jobs run on a single processor with a single thread. </p>
<p>Shown below is a simple job script that runs /bin/date (which prints the current date) on the compute node, and puts the output into the job's output file.</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run a serial job on Legion under SGE.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N Serial_Job</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.  </span>
<span class="c1">#  This is a necessary step as compute nodes cannot write to $HOME.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/workspace</span>

<span class="c1"># Your work should be done in $TMPDIR </span>
<span class="nb">cd</span> <span class="nv">$TMPDIR</span>

<span class="c1"># Run the application.</span>
/bin/date &gt; date.txt

<span class="c1"># Preferably, tar-up (archive) all output files onto the shared scratch area</span>
tar -zcvf <span class="nv">$HOME</span>/Scratch/files_from_job_<span class="nv">$JOB_ID</span>.tar.gz <span class="nv">$TMPDIR</span>

<span class="c1"># Make sure you have given enough time for the copy to complete!</span>
</pre></div>


<h2 id="multi-threaded-job-example">Multi-threaded Job Example<a class="headerlink" href="#multi-threaded-job-example" title="Permanent link">&para;</a></h2>
<p>For programs that can use multiple threads, you can request multiple <a href="Glossary#Core">processor cores</a> using the <code>-pe smp &lt;number&gt;</code> option. One common method for using multiple threads in a program is OpenMP, and the <code>OMP_NUM_THREADS</code> environment variable is set automatically in a job of this type to tell OpenMP how many threads it should use. Most methods for running multi-threaded applications should correctly detect how many cores have been allocated, though (<em>via</em> a mechanism called <code>cgroups</code>).</p>
<p>Note that this job script works directly in scratch instead of in the temporary TMPDIR storage.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run an OpenMP threaded job on Legion under SGE.

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM for each core/thread (must be an integer)
#$ -l mem=1G

# Request 15 gigabyte of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Set the name of the job.
#$ -N Multi-threaded Job

# Request 16 cores.
#$ -pe smp 16

# Set the working directory to somewhere in your scratch space.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output

# 8. Run the application.
$HOME/my_program/example
</pre></div>
</td></tr></table>

<h2 id="mpi-job-script-example">MPI Job Script Example<a class="headerlink" href="#mpi-job-script-example" title="Permanent link">&para;</a></h2>
<p>The default MPI implementation on our clusters is the Intel MPI stack. MPI programs don’t use a shared memory model so they can be run across multiple nodes.
This script differs considerably from the serial and OpenMP jobs in that MPI programs need to be invoked by a program called gerun. This is a wrapper for mpirun and takes care of passing the number of processors and a file called a machine file.</p>
<p>'''Important''': If you wish to pass a file or stream of data to the standard input (stdin) of an MPI program, there are specific command-line options you need to use to control which MPI tasks are able to receive it. (<code>-s</code> for Intel MPI, <code>--stdin</code> for OpenMPI.) Please consult the help output of the <code>mpirun</code> command for further information. The <code>gerun</code> launcher does not automatically handle this.</p>
<p>If you use OpenMPI, you need to make sure the Intel mpi modules are removed and the OpenMPI modules are loaded, either in your shell start-up files (e.g. <code>~/.bashrc</code>), or else in the script itself.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run an MPI parallel job under SGE with Intel MPI.

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM per process (must be an integer)
#$ -l mem=1G

# Request 15 gigabyte of TMPDIR space per node (default is 10 GB)
#$ -l tmpfs=15G

# Set the name of the job.
#$ -N MadScience_1_16

# Select the MPI parallel environment and 16 processes.
#$ -pe mpi 16

# Set the working directory to somewhere in your scratch space.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output

# Run our MPI job.  GERun is a wrapper that launches MPI jobs on our clusters.
gerun $HOME/src/science/simulate
</pre></div>
</td></tr></table>

<h2 id="array-job-script-example">Array Job Script Example<a class="headerlink" href="#array-job-script-example" title="Permanent link">&para;</a></h2>
<p>If you want to submit a large number of similar serial jobs then it may be
easier to submit them as an array job. Array jobs are similar to serial jobs
except we use the <code>-t</code> option to get Sun Grid Engine to run 10,000 copies of
this job numbered 1 to 10,000. Each job in this array will have the same job ID
but a different task ID. The task ID is stored in the <code>SGE_TASK_ID</code> environment
variable in each task. All the usual SGE output files have the task ID
appended. MPI jobs and parallel shared memory jobs can also be submitted as
arrays.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run a serial array job under SGE.

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM (must be an integer)
#$ -l mem=1G

# Request 15 gigabyte of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Set up the job array.  In this instance we have requested 10000 tasks
# numbered 1 to 10000.
#$ -t 1-10000

# Set the name of the job.
#$ -N MyArrayJob

# Set the working directory to somewhere in your scratch space. 
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output

# Run the application.

echo &quot;$JOB_NAME $SGE_TASK_ID&quot;
</pre></div>
</td></tr></table>

<h2 id="array-job-script-example-using-parameter-file">Array Job Script Example Using Parameter File<a class="headerlink" href="#array-job-script-example-using-parameter-file" title="Permanent link">&para;</a></h2>
<p>Often a user will want to submit a large number of similar jobs but their input parameters don't match easily on to an index from 1 to n. In these cases it's possible to use a parameter file. To use this script a user needs to construct a file with a line for each element in the job array, with parameters separated by spaces.</p>
<p>For example: </p>
<div class="codehilite"><pre><span></span>0001 1.5 3 aardvark
0002 1.1 13 guppy
0003 1.23 5 elephant
0004 1.112 23 panda
0005 ...
</pre></div>


<p>Assuming that this file is stored in <code>~/Scratch/input/params.txt</code> (you can call
this file anything you want) then the user can use awk/sed to get the
appropriate variables out of the file as with the script below which stores
them in <code>$index</code>, <code>$variable1</code>, <code>$variable2</code> and <code>$variable3</code>.  So for example in task
4, <code>$index = 0004</code>, <code>$variable1 = 1.112</code>, <code>$variable2 = 23</code> and <code>$variable3 = panda</code>.</p>
<p>Since the parameter file can be generated automatically from a user's datasets,
this approach allows the simple automation, submission and management of
thousands or tens of thousands of tasks.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run an array job.

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM (must be an integer)
#$ -l mem=1G

# Request 15 gigabyte of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Set up the job array.  In this instance we have requested 1000 tasks
# numbered 1 to 1000.
#$ -t 1-1000

# Set the name of the job.
#$ -N array-params

# Set the working directory to somewhere in your scratch space.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output

# Parse parameter file to get variables.
number=$SGE_TASK_ID
paramfile=/home/&lt;your_UCL_id&gt;/Scratch/input/params.txt

index=&quot;`sed -n ${number}p $paramfile | awk &#39;{print $1}&#39;`&quot;
variable1=&quot;`sed -n ${number}p $paramfile | awk &#39;{print $2}&#39;`&quot;
variable2=&quot;`sed -n ${number}p $paramfile | awk &#39;{print $3}&#39;`&quot;
variable3=&quot;`sed -n ${number}p $paramfile | awk &#39;{print $4}&#39;`&quot;

# Run the program (replace echo with your binary and options).

echo &quot;$index&quot; &quot;$variable1&quot; &quot;$variable2&quot; &quot;$variable3&quot;
</pre></div>
</td></tr></table>

<h2 id="example-array-job-using-local2scratch">Example Array Job Using Local2Scratch<a class="headerlink" href="#example-array-job-using-local2scratch" title="Permanent link">&para;</a></h2>
<p>Users can automate the transfer of data from $TMPDIR to their scratch space by
adding the text <code>#Local2Scratch</code> to their script on a line alone as a special comment.
During the clean-up phase of the job, a tool checks whether the script contains that
text, and if so, files are transferred from <code>$TMPDIR</code> to a directory in scratch
with the structure <code>&lt;job id&gt;/&lt;job id&gt;.&lt;task id&gt;.&lt;queue&gt;/</code>.</p>
<p>The example below does this for a job array, but this works for any job type.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run an array job under SGE and 
#  transfer the output to Scratch from local.

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM (must be an integer)
#$ -l mem=1G

# Request 15 gigabyte of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Set up the job array.  In this instance we have requested 10000 tasks
# numbered 1 to 10000.
#$ -t 1-10000

# Set the name of the job.
#$ -N local2scratcharray

# Set the working directory to somewhere in your scratch space.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output

# Automate transfer of output to Scratch from $TMPDIR.
#Local2Scratch

# Run the application in TMPDIR.
cd $TMPDIR
hostname &gt; hostname.txt
</pre></div>
</td></tr></table>

<h2 id="array-job-script-with-a-stride">Array Job Script with a Stride<a class="headerlink" href="#array-job-script-with-a-stride" title="Permanent link">&para;</a></h2>
<p>If each task for your array job is very small, you will get better use of the cluster if you can combine a number of these so each has a couple of hours' worth of work to do. There is a startup cost associated with the amount of time it takes to set up a new job. If your job's runtime is very small, this cost is proportionately high, and you incur it with every array task.</p>
<p>Using a stride will allow you to leave your input files numbered as before, and each array task will run N inputs.</p>
<p>For example, a stride of 10 will give you these task IDs: 1, 11, 21...</p>
<p>Your script can then have a loop that runs task IDs from <code>$SGE_TASK_ID</code> to <code>$SGE_TASK_ID + 9</code>, so each task is doing ten times as many runs as it was before.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run an array job with strided task IDs under SGE.

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM (must be an integer)
#$ -l mem=1G

# Request 15 gigabyte of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Set up the job array.  In this instance we have requested task IDs
# numbered 1 to 10000 with a stride of 10.
#$ -t 1-10000:10

# Set the name of the job.
#$ -N arraystride

# Set the working directory to somewhere in your scratch space.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output

# Automate transfer of output to Scratch from $TMPDIR.
#Local2Scratch

# Do your work in $TMPDIR 
cd $TMPDIR

# 10. Loop through the IDs covered by this stride and run the application if 
# the input file exists. (This is because the last stride may not have that
# many inputs available). Or you can leave out the check and get an error.
for (( i=$SGE_TASK_ID; i&lt;$SGE_TASK_ID+10; i++ ))
do
  if [ -f &quot;input.$i&quot; ]
  then
    echo &quot;$JOB_NAME&quot; &quot;$SGE_TASK_ID&quot; &quot;input.$i&quot;
  fi
done
</pre></div>
</td></tr></table>

<h2 id="gpu-job-script-example">GPU Job Script Example<a class="headerlink" href="#gpu-job-script-example" title="Permanent link">&para;</a></h2>
<p>To use NVIDIA GPUs with the CUDA libraries, you need to load the CUDA runtime libraries module or else set up the environment yourself. The script below shows what you'll need to unload and load the appropriate modules.</p>
<p>You also need to use the <code>-l gpu=&lt;number&gt;</code> option to request the GPUs from the scheduler.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Batch script to run a GPU job on Legion under SGE.

# Request a number of GPU cards, in this case 2 (the maximum)
#$ -l gpu=2

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 1 gigabyte of RAM (must be an integer)
#$ -l mem=1G

# Request 15 gigabyte of TMPDIR space (default is 10 GB)
#$ -l tmpfs=15G

# Set the name of the job.
#$ -N GPUJob

# Set the working directory to somewhere in your scratch space.
# Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)
#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output

# Change into temporary directory to run work
cd $TMPDIR

# load the cuda module (in case you are running a CUDA program
module unload compilers mpi
module load compilers/gnu/4.9.2
module load cuda/7.5.18/gnu-4.9.2

# Run the application - the line below is just a random example.
mygpucode

# 10. Preferably, tar-up (archive) all output files onto the shared scratch area
tar zcvf $HOME/Scratch/files_from_job_$JOB_ID.tar.gz $TMPDIR

# Make sure you have given enough time for the copy to complete!
</pre></div>
</td></tr></table>

<h2 id="job-using-mpi-and-gpus">Job using MPI and GPUs<a class="headerlink" href="#job-using-mpi-and-gpus" title="Permanent link">&para;</a></h2>
<p>It is possible to run MPI programs that use GPUs but our clusters currently only support this within a single node. The script below shows how to run a program using 2 gpus and 12 cpus.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>#!/bin/bash -l

# Request ten minutes of wallclock time (format hours:minutes:seconds).
#$ -l h_rt=0:10:0

# Request 12 cores, 2 GPUs, 1 gigabyte of RAM per CPU, 15 gigabyte of TMPDIR space
#$ -l mem=1G
#$ -l gpu=2
#$ -pe mpi 12
#$ -l tmpfs=15G

# Set the name of the job.
#$ -N GPUMPIrun

# Set the working directory to somewhere in your scratch space.
#$ -wd /home/&lt;your user id&gt;/Scratch/output/

# Run our MPI job. You can choose OpenMPI or IntelMPI for GCC.
module unload compilers mpi
module load compilers/gnu/4.9.2
module load mpi/openmpi/1.10.1/gnu-4.9.2
module load cuda/7.5.18/gnu-4.9.2

gerun myGPUapp
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Contact_and_Support/" title="Contact and Support" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Contact and Support
              </span>
            </div>
          </a>
        
        
          <a href="../FAQ/" title="FAQ" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                FAQ
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2014 - 2018 UCL Research Computing Group
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/UCL-RITS" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a353778b.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>