
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the centrally provided Research Computing HPC services at UCL.">
      
      
      
        <meta name="author" content="UCL RCAS Team">
      
      
        <link rel="canonical" href="https://www.rc.ucl.ac.uk/docs/Example_Jobscripts/">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.1">
    
    
      
        <title>Example Jobscripts - UCL Research Computing Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1655a90d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
    
    
    
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/tweaks.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#service-differences" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://www.rc.ucl.ac.uk/docs/" title="UCL Research Computing Documentation" class="md-header__button md-logo" aria-label="UCL Research Computing Documentation">
      
  <img src="../img/portico.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UCL Research Computing Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Example Jobscripts
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/UCL-RITS/mkdocs-rc-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    UCL-RITS/mkdocs-rc-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://www.rc.ucl.ac.uk/docs/" title="UCL Research Computing Documentation" class="md-nav__button md-logo" aria-label="UCL Research Computing Documentation">
      
  <img src="../img/portico.svg" alt="logo">

    </a>
    UCL Research Computing Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/UCL-RITS/mkdocs-rc-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    UCL-RITS/mkdocs-rc-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Account_Services/" class="md-nav__link">
        Account Services
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Additional_Resource_Requests/" class="md-nav__link">
        Additional Resource Requests
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Contact_Us/" class="md-nav__link">
        Contact and Support
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Example Jobscripts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Example Jobscripts
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-differences" class="md-nav__link">
    Service Differences
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-directories-and-output" class="md-nav__link">
    Working Directories and Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-about-projects" class="md-nav__link">
    Note about Projects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serial-job-script-example" class="md-nav__link">
    Serial Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-threaded-job-example" class="md-nav__link">
    Multi-threaded Job Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi-job-script-example" class="md-nav__link">
    MPI Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example" class="md-nav__link">
    Array Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example-using-parameter-file" class="md-nav__link">
    Array Job Script Example Using Parameter File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-array-job-using-local2scratch" class="md-nav__link">
    Example Array Job Using Local2Scratch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-with-a-stride" class="md-nav__link">
    Array Job Script with a Stride
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hybrid-mpi-plus-openmp-jobscript-example" class="md-nav__link">
    Hybrid MPI plus OpenMP jobscript example
  </a>
  
    <nav class="md-nav" aria-label="Hybrid MPI plus OpenMP jobscript example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-number-of-threads" class="md-nav__link">
    Setting number of threads
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpu-job-script-example" class="md-nav__link">
    GPU Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-using-mpi-and-gpus" class="md-nav__link">
    Job using MPI and GPUs
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Experienced_Users/" class="md-nav__link">
        Quick Start Guide for Experienced HPC Users
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Interactive_Jobs/" class="md-nav__link">
        Interactive Job Sessions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Job_Results/" class="md-nav__link">
        Where do my results go?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../New_Users/" class="md-nav__link">
        Guide for New Users
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Planned_Outages/" class="md-nav__link">
        Planned Outages
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Remote_Access/" class="md-nav__link">
        Remote Access
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Terms_and_Conditions/" class="md-nav__link">
        Terms and Conditions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../UCL_Service_For_Me/" class="md-nav__link">
        UCL Service For Me
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../howto/" class="md-nav__link">
        How To
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      <label class="md-nav__link" for="__nav_15">
        Background
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Background" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Background
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Background/Cluster_Computing/" class="md-nav__link">
        Cluster Computing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_16" type="checkbox" id="__nav_16" >
      
      <label class="md-nav__link" for="__nav_16">
        Clusters
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Clusters" data-md-level="1">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Clusters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Clusters/Myriad/" class="md-nav__link">
        Myriad
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Clusters/Grace/" class="md-nav__link">
        Grace
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Clusters/Kathleen/" class="md-nav__link">
        Kathleen
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Clusters/Thomas/" class="md-nav__link">
        MMM Thomas
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Clusters/Michael/" class="md-nav__link">
        MMM Michael
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Clusters/Young/" class="md-nav__link">
        MMM Hub Young
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_17" type="checkbox" id="__nav_17" >
      
      <label class="md-nav__link" for="__nav_17">
        Installed Software Lists
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Installed Software Lists" data-md-level="1">
        <label class="md-nav__title" for="__nav_17">
          <span class="md-nav__icon md-icon"></span>
          Installed Software Lists
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Installed_Software_Lists/module-packages/" class="md-nav__link">
        General Software Lists
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Installed_Software_Lists/python-packages/" class="md-nav__link">
        Python Packages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Installed_Software_Lists/r-packages/" class="md-nav__link">
        R Packages
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_18" type="checkbox" id="__nav_18" >
      
      <label class="md-nav__link" for="__nav_18">
        Other Services
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Other Services" data-md-level="1">
        <label class="md-nav__title" for="__nav_18">
          <span class="md-nav__icon md-icon"></span>
          Other Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Other_Services/Aristotle/" class="md-nav__link">
        Aristotle
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Other_Services/UCL_UK_e-Science_Certificates/" class="md-nav__link">
        UCL UK e-Science Certificates
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_19" type="checkbox" id="__nav_19" >
      
      <label class="md-nav__link" for="__nav_19">
        Paid-For Resources
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Paid-For Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_19">
          <span class="md-nav__icon md-icon"></span>
          Paid-For Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Paid-For_Resources/How_to_Use/" class="md-nav__link">
        How to Use
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Paid-For_Resources/Purchasing_in_Myriad/" class="md-nav__link">
        Purchasing in Myriad
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_20" type="checkbox" id="__nav_20" >
      
      <label class="md-nav__link" for="__nav_20">
        Software Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Software Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_20">
          <span class="md-nav__icon md-icon"></span>
          Software Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Software_Guides/ANSYS/" class="md-nav__link">
        ANSYS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Software_Guides/Matlab/" class="md-nav__link">
        MATLAB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Software_Guides/Singularity/" class="md-nav__link">
        Singularity
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Software_Guides/R/" class="md-nav__link">
        R
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Software_Guides/Other_Software/" class="md-nav__link">
        Other Software
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Software_Guides/Installing_Software/" class="md-nav__link">
        Installing Software
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-differences" class="md-nav__link">
    Service Differences
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-directories-and-output" class="md-nav__link">
    Working Directories and Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#note-about-projects" class="md-nav__link">
    Note about Projects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serial-job-script-example" class="md-nav__link">
    Serial Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-threaded-job-example" class="md-nav__link">
    Multi-threaded Job Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi-job-script-example" class="md-nav__link">
    MPI Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example" class="md-nav__link">
    Array Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-example-using-parameter-file" class="md-nav__link">
    Array Job Script Example Using Parameter File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-array-job-using-local2scratch" class="md-nav__link">
    Example Array Job Using Local2Scratch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-job-script-with-a-stride" class="md-nav__link">
    Array Job Script with a Stride
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hybrid-mpi-plus-openmp-jobscript-example" class="md-nav__link">
    Hybrid MPI plus OpenMP jobscript example
  </a>
  
    <nav class="md-nav" aria-label="Hybrid MPI plus OpenMP jobscript example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-number-of-threads" class="md-nav__link">
    Setting number of threads
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpu-job-script-example" class="md-nav__link">
    GPU Job Script Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-using-mpi-and-gpus" class="md-nav__link">
    Job using MPI and GPUs
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/UCL-RITS/mkdocs-rc-docs/blob/master/mkdocs-project-dir/docs/Example_Jobscripts.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Example Jobscripts</h1>
                
                <p>On this page we describe some basic example scripts to submit jobs to
our clusters.</p>
<p>After creating your script, submit it to the scheduler with:</p>
<p><code>qsub my_script.sh</code></p>
<h2 id="service-differences">Service Differences<a class="headerlink" href="#service-differences" title="Permanent link">§</a></h2>
<p>These scripts are applicable to all our clusters, but node sizes (core count, memory, and temporary storage sizes) differ between machines, so please check those details on the cluster-specific pages.
Some clusters are diskless and have no temporary space that can be requested.</p>
<h2 id="working-directories-and-output">Working Directories and Output<a class="headerlink" href="#working-directories-and-output" title="Permanent link">§</a></h2>
<p>The parallel filesystems we use to provide the home and scratch filesystems perform best when reading or writing single large files, and worst when operating on many different small files. To avoid causing problems, many of the scripts below are written to create all their files in the temporary <code>$TMPDIR</code> storage, and compress and copy them to the scratch area at the end of the job.</p>
<p>This can be a problem if your job is not finishing and you need to see the output, or if your job is crashing or failing to produce what you expected. Feel free to modify the scripts to read from or write to Scratch directly, however, your performance will generally not be as good as writing to <code>$TMPDIR</code>, and you may impact the general performance of the machine if you do this with many jobs simultaneously. This is particularly the case with single-core jobs, because that core is guaranteed to be writing out data.</p>
<p>Please be aware that some clusters are diskless (eg Kathleen) and have no <code>$TMPDIR</code> available 
for use - in those you must remove the request for <code>tmpfs</code> in your script. Check the 
cluster-specific pages.</p>
<p>Note that there is also the option of using the <code>Local2Scratch</code> process 
(<a href="#Example Serial Job Using Local2Scratch">see below</a>), which takes place <em>after</em> the
job has finished, in the clean-up step. This gives you the option of always
getting the contents of <code>$TMPDIR</code> back, at the cost of possibly getting incomplete
files and not having any control over where the files go.</p>
<h2 id="note-about-projects">Note about Projects<a class="headerlink" href="#note-about-projects" title="Permanent link">§</a></h2>
<p>Projects are a system used in the scheduler and the accounting system 
to track budgets and access controls.</p>
<p>Most users of UCL's internal clusters will not need to specify a project and will default to the AllUsers 
project. Users of the Thomas and Michael services should refer to the specific 
pages for those machines, and the information they were given when they registered.</p>
<p>To specify a project ID in a job script, use the <code>-P</code> object as below:</p>
<div class="codehilite"><pre><span></span><code>#$ -P &lt;your_project_id&gt;
</code></pre></div>

<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">§</a></h2>
<p>The lines starting with <code>#$ -l</code> are where you are requesting resources like wallclock 
time (how long your job is allowed to run), memory, and possibly tmpfs (local hard 
disk space on the node, if it is not diskless).</p>
<p>If you have no notion of how much you should request for any of these, have a look at <a href="../howto/#how-do-i-estimate-what-resources-to-request-in-my-jobscript">How do I estimate what resources to request in my jobscript?</a></p>
<h2 id="serial-job-script-example">Serial Job Script Example<a class="headerlink" href="#serial-job-script-example" title="Permanent link">§</a></h2>
<p>The most basic type of job a user can submit is a serial job. These jobs run on a single processor (core) with a single thread. </p>
<p>Shown below is a simple job script that runs /bin/date (which prints the current date) on the compute node, and puts the output into a file.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run a serial job under SGE.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N Serial_Job</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.  </span>
<span class="c1">#  This is a necessary step as compute nodes cannot write to $HOME.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID.</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/workspace</span>

<span class="c1"># Your work should be done in $TMPDIR </span>
<span class="nb">cd</span> <span class="nv">$TMPDIR</span>

<span class="c1"># Run the application and put the output into a file called date.txt</span>
/bin/date &gt; date.txt

<span class="c1"># Preferably, tar-up (archive) all output files onto the shared scratch area</span>
tar -zcvf <span class="nv">$HOME</span>/Scratch/files_from_job_<span class="nv">$JOB_ID</span>.tar.gz <span class="nv">$TMPDIR</span>

<span class="c1"># Make sure you have given enough time for the copy to complete!</span>
</code></pre></div>

<h2 id="multi-threaded-job-example">Multi-threaded Job Example<a class="headerlink" href="#multi-threaded-job-example" title="Permanent link">§</a></h2>
<p>For programs that can use multiple threads, you can request multiple <a href="Glossary#Core">processor cores</a> using the <code>-pe smp &lt;number&gt;</code> option. One common method for using multiple threads in a program is OpenMP, and the <code>$OMP_NUM_THREADS</code> environment variable is set automatically in a job of this type to tell OpenMP how many threads it should use. Most methods for running multi-threaded applications should correctly detect how many cores have been allocated, though (<em>via</em> a mechanism called <code>cgroups</code>).</p>
<p>Note that this job script works directly in scratch instead of in the temporary <code>$TMPDIR</code> storage.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run an OpenMP threaded job under SGE.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM for each core/thread </span>
<span class="c1"># (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N Multi-threaded Job</span>

<span class="c1"># Request 16 cores.</span>
<span class="c1">#$ -pe smp 16</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output</span>

<span class="c1"># 8. Run the application.</span>
<span class="nv">$HOME</span>/my_program/example
</code></pre></div>

<h2 id="mpi-job-script-example">MPI Job Script Example<a class="headerlink" href="#mpi-job-script-example" title="Permanent link">§</a></h2>
<p>The default MPI implementation on our clusters is the Intel MPI stack. MPI programs don’t use a shared memory model so they can be run across multiple nodes.
This script differs considerably from the serial and OpenMP jobs in that MPI programs need to be invoked by a program called gerun. This is our wrapper for mpirun and takes care of passing the number of processors and a file called a machine file.</p>
<p><strong><em>Important</em></strong>: If you wish to pass a file or stream of data to the standard input (stdin) of an MPI program, there are specific command-line options you need to use to control which MPI tasks are able to receive it. (<code>-s</code> for Intel MPI, <code>--stdin</code> for OpenMPI.) Please consult the help output of the <code>mpirun</code> command for further information. The <code>gerun</code> launcher does not automatically handle this.</p>
<p>If you use OpenMPI, you need to make sure the Intel MPI modules are removed and the OpenMPI 
modules are loaded, either in your jobscript or in your shell start-up files (e.g. <code>~/.bashrc</code>).</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run an MPI parallel job under SGE with Intel MPI.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM per process (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space per node </span>
<span class="c1"># (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N MadScience_1_16</span>

<span class="c1"># Select the MPI parallel environment and 16 processes.</span>
<span class="c1">#$ -pe mpi 16</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output</span>

<span class="c1"># Run our MPI job.  GERun is a wrapper that launches MPI jobs on our clusters.</span>
gerun <span class="nv">$HOME</span>/src/science/simulate
</code></pre></div>

<h2 id="array-job-script-example">Array Job Script Example<a class="headerlink" href="#array-job-script-example" title="Permanent link">§</a></h2>
<p>If you want to submit a large number of similar serial jobs then it may be
easier to submit them as an array job. Array jobs are similar to serial jobs
except we use the <code>-t</code> option to get Sun Grid Engine to run 10,000 copies of
this job numbered 1 to 10,000. Each job in this array will have the same job ID
but a different task ID. The task ID is stored in the <code>$SGE_TASK_ID</code> environment
variable in each task. All the usual SGE output files have the task ID
appended. MPI jobs and parallel shared memory jobs can also be submitted as
arrays.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run a serial array job under SGE.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set up the job array.  In this instance we have requested 10000 tasks</span>
<span class="c1"># numbered 1 to 10000.</span>
<span class="c1">#$ -t 1-10000</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N MyArrayJob</span>

<span class="c1"># Set the working directory to somewhere in your scratch space. </span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output</span>

<span class="c1"># Run the application.</span>

<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$JOB_NAME</span><span class="s2"> </span><span class="nv">$SGE_TASK_ID</span><span class="s2">&quot;</span>
</code></pre></div>

<h2 id="array-job-script-example-using-parameter-file">Array Job Script Example Using Parameter File<a class="headerlink" href="#array-job-script-example-using-parameter-file" title="Permanent link">§</a></h2>
<p>Often a user will want to submit a large number of similar jobs but their input parameters don't match easily on to an index from 1 to n. In these cases it's possible to use a parameter file. To use this script a user needs to construct a file with a line for each element in the job array, with parameters separated by spaces.</p>
<p>For example: </p>
<div class="codehilite"><pre><span></span><code>0001 1.5 3 aardvark
0002 1.1 13 guppy
0003 1.23 5 elephant
0004 1.112 23 panda
0005 ...
</code></pre></div>

<p>Assuming that this file is stored in <code>~/Scratch/input/params.txt</code> (you can call
this file anything you want) then the user can use awk/sed to get the
appropriate variables out of the file. The script below does this and stores
them in <code>$index</code>, <code>$variable1</code>, <code>$variable2</code> and <code>$variable3</code>.  So for example in task
4, <code>$index = 0004</code>, <code>$variable1 = 1.112</code>, <code>$variable2 = 23</code> and <code>$variable3 = panda</code>.</p>
<p>Since the parameter file can be generated automatically from a user's datasets,
this approach allows the simple automation, submission and management of
thousands or tens of thousands of tasks.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run an array job.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set up the job array.  In this instance we have requested 1000 tasks</span>
<span class="c1"># numbered 1 to 1000.</span>
<span class="c1">#$ -t 1-1000</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N array-params</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output</span>

<span class="c1"># Parse parameter file to get variables.</span>
<span class="nv">number</span><span class="o">=</span><span class="nv">$SGE_TASK_ID</span>
<span class="nv">paramfile</span><span class="o">=</span>/home/&lt;your_UCL_id&gt;/Scratch/input/params.txt

<span class="nv">index</span><span class="o">=</span><span class="s2">&quot;`sed -n </span><span class="si">${</span><span class="nv">number</span><span class="si">}</span><span class="s2">p </span><span class="nv">$paramfile</span><span class="s2"> | awk &#39;{print </span><span class="nv">$1</span><span class="s2">}&#39;`&quot;</span>
<span class="nv">variable1</span><span class="o">=</span><span class="s2">&quot;`sed -n </span><span class="si">${</span><span class="nv">number</span><span class="si">}</span><span class="s2">p </span><span class="nv">$paramfile</span><span class="s2"> | awk &#39;{print </span><span class="nv">$2</span><span class="s2">}&#39;`&quot;</span>
<span class="nv">variable2</span><span class="o">=</span><span class="s2">&quot;`sed -n </span><span class="si">${</span><span class="nv">number</span><span class="si">}</span><span class="s2">p </span><span class="nv">$paramfile</span><span class="s2"> | awk &#39;{print </span><span class="nv">$3</span><span class="s2">}&#39;`&quot;</span>
<span class="nv">variable3</span><span class="o">=</span><span class="s2">&quot;`sed -n </span><span class="si">${</span><span class="nv">number</span><span class="si">}</span><span class="s2">p </span><span class="nv">$paramfile</span><span class="s2"> | awk &#39;{print </span><span class="nv">$4</span><span class="s2">}&#39;`&quot;</span>

<span class="c1"># Run the program (replace echo with your binary and options).</span>

<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$index</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$variable1</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$variable2</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$variable3</span><span class="s2">&quot;</span>
</code></pre></div>

<h2 id="example-array-job-using-local2scratch">Example Array Job Using Local2Scratch<a class="headerlink" href="#example-array-job-using-local2scratch" title="Permanent link">§</a></h2>
<p>Users can automate the transfer of data from <code>$TMPDIR</code> to their scratch space by
adding the text <code>#Local2Scratch</code> to their script on a line alone as a special comment.
During the clean-up phase of the job, a tool checks whether the script contains that
text, and if so, files are transferred from <code>$TMPDIR</code> to a directory in scratch
with the structure <code>&lt;job id&gt;/&lt;job id&gt;.&lt;task id&gt;.&lt;queue&gt;/</code>.</p>
<p>The example below does this for a job array, but this works for any job type.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run an array job under SGE and </span>
<span class="c1">#  transfer the output to Scratch from local.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set up the job array.  In this instance we have requested 10000 tasks</span>
<span class="c1"># numbered 1 to 10000.</span>
<span class="c1">#$ -t 1-10000</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N local2scratcharray</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output</span>

<span class="c1"># Automate transfer of output to Scratch from $TMPDIR.</span>
<span class="c1">#Local2Scratch</span>

<span class="c1"># Run the application in TMPDIR.</span>
<span class="nb">cd</span> <span class="nv">$TMPDIR</span>
hostname &gt; hostname.txt
</code></pre></div>

<h2 id="array-job-script-with-a-stride">Array Job Script with a Stride<a class="headerlink" href="#array-job-script-with-a-stride" title="Permanent link">§</a></h2>
<p>If each task for your array job is very small, you will get better use of the cluster if you can combine a number of these so each has a couple of hours' worth of work to do. There is a startup cost associated with the amount of time it takes to set up a new job. If your job's runtime is very small, this cost is proportionately high, and you incur it with every array task.</p>
<p>Using a stride will allow you to leave your input files numbered as before, and each array task will run N inputs.</p>
<p>For example, a stride of 10 will give you these task IDs: 1, 11, 21...</p>
<p>Your script can then have a loop that runs task IDs from <code>$SGE_TASK_ID</code> to <code>$SGE_TASK_ID + 9</code>, so each task is doing ten times as many runs as it was before.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run an array job with strided task IDs under SGE.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set up the job array.  In this instance we have requested task IDs</span>
<span class="c1"># numbered 1 to 10000 with a stride of 10.</span>
<span class="c1">#$ -t 1-10000:10</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N arraystride</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output</span>

<span class="c1"># Automate transfer of output to Scratch from $TMPDIR.</span>
<span class="c1">#Local2Scratch</span>

<span class="c1"># Do your work in $TMPDIR </span>
<span class="nb">cd</span> <span class="nv">$TMPDIR</span>

<span class="c1"># 10. Loop through the IDs covered by this stride and run the application if </span>
<span class="c1"># the input file exists. (This is because the last stride may not have that</span>
<span class="c1"># many inputs available). Or you can leave out the check and get an error.</span>
<span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span><span class="nv">$SGE_TASK_ID</span><span class="p">;</span> i&lt;<span class="nv">$SGE_TASK_ID</span>+10<span class="p">;</span> i++ <span class="o">))</span>
<span class="k">do</span>
  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;input.</span><span class="nv">$i</span><span class="s2">&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$JOB_NAME</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$SGE_TASK_ID</span><span class="s2">&quot;</span> <span class="s2">&quot;input.</span><span class="nv">$i</span><span class="s2">&quot;</span>
  <span class="k">fi</span>
<span class="k">done</span>
</code></pre></div>

<h2 id="hybrid-mpi-plus-openmp-jobscript-example">Hybrid MPI plus OpenMP jobscript example<a class="headerlink" href="#hybrid-mpi-plus-openmp-jobscript-example" title="Permanent link">§</a></h2>
<p>This is a type of job where you have a small number of MPI processes, and each
one of those launches a number of threads. One common form of this is to have
only one MPI process per node which handles communication between nodes, and 
the work on each node is done in a shared memory style by threads.</p>
<p>When requesting resources for this type of job, what you are asking the scheduler
for is the physical number of cores and amount of memory per core that you need.
Whether you end up running MPI processes or threads on that core is up to your code.
(The <code>-pe mpi xx</code> request is telling it you want an MPI parallel environment and 
xx number of cores, not that you want xx MPI processes - this can be confusing).</p>
<h3 id="setting-number-of-threads">Setting number of threads<a class="headerlink" href="#setting-number-of-threads" title="Permanent link">§</a></h3>
<p>You can either set <code>$OMP_NUM_THREADS</code> for the number of OpenMP threads yourself, 
or allow it to be worked out automatically by setting it to <code>OMP_NUM_THREADS=$(ppn)</code>. 
That is a helper script on our clusters which will set <code>$OMP_NUM_THREADS</code> to 
<code>$NSLOTS/$NHOSTS</code>, so you will use threads within a node and MPI between nodes 
and don't need to know in advance what size of node you are running on. Gerun 
will then run <code>$NSLOTS/$OMP_NUM_THREADS</code> processes, round-robin allocated (if 
supported by the MPI).</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run a hybrid parallel job under SGE.</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM per core (must be an integer)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabytes of TMPDIR space per node (default is 10 GB - remove if cluster is diskless)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N MadIntelHybrid</span>

<span class="c1"># Select the MPI parallel environment and 80 cores.</span>
<span class="c1">#$ -pe mpi 80</span>

<span class="c1"># Set the working directory to somewhere in your scratch space. </span>
<span class="c1"># This directory musgt exist.</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id/scratch/output/</span>

<span class="c1"># Automatically set threads using ppn. On a cluster with 40 cores</span>
<span class="c1"># per node this will be 80/2 = 40 threads.</span>
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="k">$(</span>ppn<span class="k">)</span>

<span class="c1"># Run our MPI job with the default modules. Gerun is a wrapper script for mpirun. </span>
gerun <span class="nv">$HOME</span>/src/madscience/madhybrid
</code></pre></div>

<p>If you want to specify a specific number of OMP threads yourself, you would alter 
the relevant lines above to this:</p>
<div class="codehilite"><pre><span></span><code># Request 80 cores and run 4 MPI processes per 40-core node, each spawning 10 threads
#$ -pe mpi 80
export OMP_NUM_THREADS=10
gerun your_binary
</code></pre></div>

<h2 id="gpu-job-script-example">GPU Job Script Example<a class="headerlink" href="#gpu-job-script-example" title="Permanent link">§</a></h2>
<p>To use NVIDIA GPUs with the CUDA libraries, you need to load the CUDA runtime libraries module or else set up the environment yourself. The script below shows what you'll need to unload and load the appropriate modules.</p>
<p>You also need to use the <code>-l gpu=&lt;number&gt;</code> option to request the GPUs from the scheduler.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Batch script to run a GPU job under SGE.</span>

<span class="c1"># Request a number of GPU cards, in this case 2 (the maximum)</span>
<span class="c1">#$ -l gpu=2</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 1 gigabyte of RAM (must be an integer followed by M, G, or T)</span>
<span class="c1">#$ -l mem=1G</span>

<span class="c1"># Request 15 gigabyte of TMPDIR space (default is 10 GB)</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N GPUJob</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.</span>
<span class="c1"># Replace &quot;&lt;your_UCL_id&gt;&quot; with your UCL user ID :)</span>
<span class="c1">#$ -wd /home/&lt;your_UCL_id&gt;/Scratch/output</span>

<span class="c1"># Change into temporary directory to run work</span>
<span class="nb">cd</span> <span class="nv">$TMPDIR</span>

<span class="c1"># load the cuda module (in case you are running a CUDA program)</span>
module unload compilers mpi
module load compilers/gnu/4.9.2
module load cuda/7.5.18/gnu-4.9.2

<span class="c1"># Run the application - the line below is just a random example.</span>
mygpucode

<span class="c1"># 10. Preferably, tar-up (archive) all output files onto the shared scratch area</span>
tar zcvf <span class="nv">$HOME</span>/Scratch/files_from_job_<span class="nv">$JOB_ID</span>.tar.gz <span class="nv">$TMPDIR</span>

<span class="c1"># Make sure you have given enough time for the copy to complete!</span>
</code></pre></div>

<h2 id="job-using-mpi-and-gpus">Job using MPI and GPUs<a class="headerlink" href="#job-using-mpi-and-gpus" title="Permanent link">§</a></h2>
<p>It is possible to run MPI programs that use GPUs but our clusters currently only support this within a single node. The script below shows how to run a program using 2 gpus and 12 cpus.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>

<span class="c1"># Request ten minutes of wallclock time (format hours:minutes:seconds).</span>
<span class="c1">#$ -l h_rt=0:10:0</span>

<span class="c1"># Request 12 cores, 2 GPUs, 1 gigabyte of RAM per CPU, 15 gigabyte of TMPDIR space</span>
<span class="c1">#$ -l mem=1G</span>
<span class="c1">#$ -l gpu=2</span>
<span class="c1">#$ -pe mpi 12</span>
<span class="c1">#$ -l tmpfs=15G</span>

<span class="c1"># Set the name of the job.</span>
<span class="c1">#$ -N GPUMPIrun</span>

<span class="c1"># Set the working directory to somewhere in your scratch space.</span>
<span class="c1">#$ -wd /home/&lt;your user id&gt;/Scratch/output/</span>

<span class="c1"># Run our MPI job. You can choose OpenMPI or IntelMPI for GCC.</span>
module unload compilers mpi
module load compilers/gnu/4.9.2
module load mpi/openmpi/1.10.1/gnu-4.9.2
module load cuda/7.5.18/gnu-4.9.2

gerun myGPUapp
</code></pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../Contact_Us/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Contact and Support
            </div>
          </div>
        </a>
      
      
        <a href="../Experienced_Users/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Quick Start Guide for Experienced HPC Users
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2014 - 2020 UCL Research Computing Group
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/UCL-RITS" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.f5903571.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4e3fea51.min.js"></script>
      
    
  </body>
</html>